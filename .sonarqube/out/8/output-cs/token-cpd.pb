ñ
DD:\Repos\CommonCore\CommonCore2\Extensions\CommonObjectExtensions.cs
	namespace 	
CommonCore2
 
. 

Extensions  
{ 
public 

static 
class "
CommonObjectExtensions .
{ 
public 
static 
bool 

BytesEqual %
(% &
this& *
byte+ /
[/ 0
]0 1
one2 5
,5 6
byte7 ;
[; <
]< =
two> A
)A B
{ 	
if		 
(		 
one		 
==		 
null		 
&&		 
two		 "
==		# %
null		& *
)		* +
return		, 2
true		3 7
;		7 8
if 
( 
one 
== 
null 
^ 
two !
==" $
null% )
|| 
one 
. 
Length 
!=  
two! $
.$ %
Length% +
)+ ,
return- 3
false4 9
;9 :
return 
! 
one 
. 
Where 
( 
( 
x 
, 
i 
) 
=>  
x! "
!=# %
two& )
[) *
i* +
]+ ,
), -
. 
Any 
( 
) 
; 
} 	
} 
} ´

:D:\Repos\CommonCore\CommonCore2\Extensions\EFExtensions.cs
	namespace 	
CommonCore2
 
. 

Extensions  
{ 
public 

static 
class 
EFExtensions $
{ 
public 
static 
string 
ToSqlParamsString .
(. /
this/ 3
IDictionary4 ?
<? @
string@ F
,F G
stringH N
>N O
dictP T
)T U
{ 	
string		 
result		 
=		 
string		 "
.		" #
Empty		# (
;		( )
foreach

 
(

 
var

 
kvp

 
in

 
dict

  $
)

$ %
{ 
result 
+= 
$" 
$str 
{ 
kvp !
.! "
Key" %
}% &
$str& (
{( )
kvp) ,
., -
Value- 2
}2 3
$str3 5
"5 6
;6 7
} 
return 
result 
. 
Trim 
( 
$char "
," #
$char$ '
)' (
;( )
} 	
} 
} ¨
GD:\Repos\CommonCore\CommonCore2\Extensions\FluentValidatorExtensions.cs
	namespace 	
CommonCore2
 
. 

Extensions  
{ 
public 

static 
class %
FluentValidatorExtensions 1
{ 
public		 
static		 
ApiResponse		 !
<		! "
T		" #
>		# $
To400		% *
<		* +
T		+ ,
>		, -
(		- .
this		. 2
ValidationResult		3 C
	validator		D M
)		M N
=>

 
new

 
ApiResponse

 
<

 
T

  
>

  !
(

! "
)

" #
{ 
FailureMessage 
=  
$str! =
,= >
Errors 
= 
	validator "
." #
Errors# )
.) *
Select* 0
(0 1
x1 2
=>3 5
new6 9
ErrorResponse: G
(G H
)H I
{ 
Message 
= 
x 
.  
ErrorMessage  ,
,, -
	ErrorCode 
= 
x  !
.! "
	ErrorCode" +
} 
) 
. 
ToList 
( 
) 
, 
Sucess 
= 
false 
, 
Data 
= 
default 
( 
T  
)  !
} 
; 
} 
} »
<D:\Repos\CommonCore\CommonCore2\Extensions\GuidExtensions.cs
	namespace 	
CommonCore2
 
. 

Extensions  
{ 
public 

static 
class 
GuidExtensions &
{ 
public		 
static		 
string		 
Merge		 "
(		" #
this		# '
Guid		( ,
one		- 0
,		0 1
Guid		2 6
two		7 :
)		: ;
=>

 
new

 
List

 
<

 
Guid

 
>

 
(

 
)

 
{

  !
one

" %
,

% &
two

' *
}

+ ,
. 
OrderBy 
( 
x 
=> 
x 
.  
GetHashCode  +
(+ ,
), -
)- .
. 
Select 
( 
y 
=> 
y 
. 
ToString '
(' (
)( )
.) *
ToLowerInvariant* :
(: ;
); <
)< =
. 
	Aggregate 
( 
( 
a 
, 
b  
)  !
=>" $
$"% '
{' (
a( )
.) *
ToLowerInvariant* :
(: ;
); <
}< =
$str= >
{> ?
b? @
.@ A
ToLowerInvariantA Q
(Q R
)R S
}S T
"T U
)U V
;V W
} 
} –)
<D:\Repos\CommonCore\CommonCore2\Extensions\TaskExtensions.cs
	namespace 	
CommonCore2
 
. 
	Threading 
{ 
public 

static 
class 
TaskExtensions &
{		 
public

 
async

 
static

 
Task

  
<

  !
IEnumerable

! ,
<

, -
TReturnType

- 8
>

8 9
>

9 :
ProcessInChunks

; J
<

J K
TRequestType

K W
,

W X
TReturnType

Y d
>

d e
(

e f
this 
Func 
< 
TRequestType "
," #
Task$ (
<( )
TReturnType) 4
>4 5
>5 6
func7 ;
,; <
IEnumerable 
< 
TRequestType $
>$ %
data& *
,* +
int 
	chunksize 
= 
$num 
) 
{ 	
if 
( 
	chunksize 
<= 
$num 
) 
throw  %
new& )
	Exception* 3
(3 4
$str4 W
)W X
;X Y
var 
result 
= 
new 
List !
<! "
TReturnType" -
>- .
(. /
)/ 0
;0 1
var 
queue 
= 
new 
Queue !
<! "
Task" &
<& '
IEnumerable' 2
<2 3
TReturnType3 >
>> ?
>? @
>@ A
(A B
)B C
;C D
var 
skip 
= 
$num 
; 
while 
( 
skip 
<= 
data 
.  
Count  %
(% &
)& '
)' (
{ 
var 
	dataLocal 
= 
data  $
.$ %
Skip% )
() *
skip* .
). /
./ 0
Take0 4
(4 5
	chunksize5 >
)> ?
;? @
var 
tasks 
= 
func  
.  !
ProcessInChunks! 0
(0 1
	dataLocal1 :
): ;
;; <
queue 
. 
Enqueue 
( 
tasks #
)# $
;$ %
skip 
+= 
	chunksize !
;! "
} 
while 
( 
queue 
. 

TryDequeue #
(# $
out$ '
Task( ,
<, -
IEnumerable- 8
<8 9
TReturnType9 D
>D E
>E F
tasksG L
)L M
)M N
{ 
var   
res   
=   
await   
tasks    %
;  % &
result!! 
.!! 
AddRange!! 
(!!  
res!!  #
)!!# $
;!!$ %
}"" 
return$$ 
result$$ 
;$$ 
}%% 	
private'' 
async'' 
static'' 
Task'' !
<''! "
IEnumerable''" -
<''- .
TReturnType''. 9
>''9 :
>'': ;
ProcessInChunks''< K
<''K L
TRequestType''L X
,''X Y
TReturnType''Z e
>''e f
(''f g
this(( 
Func(( 
<(( 
TRequestType(( !
,((! "
Task((# '
<((' (
TReturnType((( 3
>((3 4
>((4 5
func((6 :
,((: ;
IEnumerable)) 
<)) 
TRequestType)) #
>))# $
data))% )
)** 
{++ 	
var,, 
result,, 
=,, 
new,, 
List,, !
<,,! "
TReturnType,," -
>,,- .
(,,. /
),,/ 0
;,,0 1
var-- 
queue-- 
=-- 
new-- 
Queue-- !
<--! "
Task--" &
<--& '
TReturnType--' 2
>--2 3
>--3 4
(--4 5
)--5 6
;--6 7
foreach// 
(// 
var// 
datum// 
in// !
data//" &
)//& '
{00 
var11 
task11 
=11 
func11 
(11  
datum11  %
)11% &
;11& '
queue22 
.22 
Enqueue22 
(22 
task22 "
)22" #
;22# $
}33 
while44 
(44 
queue44 
.44 

TryDequeue44 #
(44# $
out44$ '
Task44( ,
<44, -
TReturnType44- 8
>448 9
task44: >
)44> ?
)44? @
{55 
var66 
res66 
=66 
await66 
task66  $
;66$ %
result77 
.77 
Add77 
(77 
res77 
)77 
;77  
}88 
return99 
result99 
;99 
}:: 	
};; 
}<< ı
/D:\Repos\CommonCore\CommonCore2\FuncComparer.cs
	namespace 	
CommonCore2
 
{ 
public 

class 
FuncComparer 
< 
T 
>  
:! "
IEqualityComparer# 4
<4 5
T5 6
>6 7
{ 
public

 
Func

 
<

 
T

 
?

 
,

 
T

 
?

 
,

 
bool

  
>

  !
_expression

" -
;

- .
public 
FuncComparer 
( 
Func 
< 
T 
, 
T 
, 
bool 
> 

expression '
) 
{ 	
_expression 
= 

expression $
;$ %
} 	
public 
bool 
Equals 
( 
T 
? 
x 
,  
T! "
?" #
y$ %
)% &
=> 
_expression 
( 
x 
, 
y 
)  
;  !
public 
int 
GetHashCode 
( 
[  
DisallowNull  ,
], -
T. /
obj0 3
)3 4
=> 
obj 
. 
GetHashCode 
( 
)  
;  !
} 
} ±c
?D:\Repos\CommonCore\CommonCore2\Loaders\AuthenticationLoader.cs
	namespace 	
CommonCore2
 
. 
Loaders 
{ 
public 

class  
AuthenticationLoader %
:& '!
IAuthenticationLoader( =
{ 
public 
int 

Iterations 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
$num. 0
;0 1
public 
int 

SaltLength 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
$num. 0
;0 1
public 
int 

HashLength 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
$num. 0
;0 1
private 
readonly 
ICrudRepository (
<( )
PasswordRecord) 7
>7 8 
_passwordsRepository9 M
;M N
public  
AuthenticationLoader #
(# $"
ICrudRepositoryFactory "!
crudRepositoryFactory# 8
) 
{ 	 
_passwordsRepository  
=! "!
crudRepositoryFactory# 8
.8 9
Get9 <
<< =
PasswordRecord= K
>K L
(L M
)M N
;N O
} 	
public  
AuthenticationLoader #
(# $"
ICrudRepositoryFactory   "!
crudRepositoryFactory  # 8
,  8 9
IConfiguration!! 
configuration!! (
)"" 
:"" 
this"" 
("" !
crudRepositoryFactory"" *
)""* +
{## 	
var$$ 
iterationsSettings$$ "
=$$# $
configuration$$% 2
.$$2 3
GetValue$$3 ;
<$$; <
int$$< ?
>$$? @
($$@ A
$str$$A g
)$$g h
;$$h i
var%% 
saltLengthSettings%% "
=%%# $
configuration%%% 2
.%%2 3
GetValue%%3 ;
<%%; <
int%%< ?
>%%? @
(%%@ A
$str%%A g
)%%g h
;%%h i
var&& 
hashLengthSettings&& "
=&&# $
configuration&&% 2
.&&2 3
GetValue&&3 ;
<&&; <
int&&< ?
>&&? @
(&&@ A
$str&&A g
)&&g h
;&&h i
if(( 
((( 
iterationsSettings(( "
>((# $
$num((% &
)((& '

Iterations((( 2
=((3 4
iterationsSettings((5 G
;((G H
if)) 
()) 
saltLengthSettings)) "
>))# $
$num))% &
)))& '

SaltLength))( 2
=))3 4
saltLengthSettings))5 G
;))G H
if** 
(** 
hashLengthSettings** "
>**# $
$num**% &
)**& '

HashLength**( 2
=**3 4
hashLengthSettings**5 G
;**G H
}++ 	
public-- 
async-- 
Task-- 
<-- 
	IResponse-- #
>--# $
SetupPassword--% 2
(--2 3
PasswordRequest--3 B
request--C J
)--J K
{.. 	
var// 
existingRecord// 
=//  
await//! & 
_passwordsRepository//' ;
.00 
First00 
(00 
x00 
=>00 
x00 
.00 
UserName00 &
==00' )
request00* 1
.001 2
UserName002 :
)00: ;
;00; <
if11 
(11 
existingRecord11 
!=11 !
null11" &
)11& '
throw22 
new22 
	Exception22 #
(22# $
$"22$ &
$str22& +
{22+ ,
request22, 3
.223 4
UserName224 <
}22< =
$str22= T
"22T U
)22U V
;22V W
var44 
(44 
passwordHash44 
,44 
salt44 #
)44# $
=44% &
GenerateHash44' 3
(443 4
request444 ;
.44; <
Password44< D
,44D E

SaltLength44F P
,44P Q

HashLength44R \
,44\ ]

Iterations44^ h
)44h i
;44i j
var66 
record66 
=66 
new66 
PasswordRecord66 +
(66+ ,
)66, -
{77 
PasswordHash88 
=88 
passwordHash88 +
,88+ ,
Salt99 
=99 
salt99 
,99 

Iterations:: 
=:: 

Iterations:: '
,::' (
UserName;; 
=;; 
request;; "
.;;" #
UserName;;# +
,;;+ ,

HashLength<< 
=<< 

HashLength<< '
}== 
;== 
await@@  
_passwordsRepository@@ &
.@@& '
Create@@' -
(@@- .
record@@. 4
)@@4 5
;@@5 6
returnBB 
newBB 
MethodResponseBB %
(BB% &
)BB& '
{CC 
SucessDD 
=DD 
trueDD 
,DD 
ErrorsEE 
=EE 
newEE 
ListEE !
<EE! "
ErrorResponseEE" /
>EE/ 0
(EE0 1
)EE1 2
}FF 
;FF 
}GG 	
privateII 
byteII 
[II 
]II 
GenerateSaltII #
(II# $
intII$ '
lengthII( .
)II. /
{JJ 	
byteKK 
[KK 
]KK 
resultKK 
=KK 
newKK 
byteKK  $
[KK$ %
lengthKK% +
]KK+ ,
;KK, -
usingMM 
(MM 
varMM 
rngMM 
=MM 
newMM  $
RNGCryptoServiceProviderMM! 9
(MM9 :
)MM: ;
)MM; <
{NN 
rngOO 
.OO 
GetBytesOO 
(OO 
resultOO #
)OO# $
;OO$ %
}PP 
returnQQ 
resultQQ 
;QQ 
}RR 	
privateTT 
byteTT 
[TT 
]TT 
GenerateHashTT #
(TT# $
byteTT$ (
[TT( )
]TT) *
passwordTT+ 3
,TT3 4
byteTT5 9
[TT9 :
]TT: ;
saltTT< @
,TT@ A
intTTB E
lengthTTF L
,TTL M
intTTN Q

iterationsTTR \
=TT] ^
$numTT_ b
)TTb c
{UU 	
byteVV 
[VV 
]VV 
resultVV 
=VV 
newVV 
byteVV  $
[VV$ %
lengthVV% +
]VV+ ,
;VV, -
usingXX 
(XX 
varXX 
derviedBytesXX #
=XX$ %
newXX& )
Rfc2898DeriveBytesXX* <
(XX< =
passwordXX= E
,XXE F
saltXXG K
,XXK L

iterationsXXM W
)XXW X
)XXX Y
{YY 
resultZZ 
=ZZ 
derviedBytesZZ %
.ZZ% &
GetBytesZZ& .
(ZZ. /
lengthZZ/ 5
)ZZ5 6
;ZZ6 7
}[[ 
return]] 
result]] 
;]] 
}^^ 	
private`` 
byte`` 
[`` 
]`` 
GenerateHash`` #
(``# $
string``$ *
password``+ 3
,``3 4
byte``5 9
[``9 :
]``: ;
salt``< @
,``@ A
int``B E
length``F L
,``L M
int``N Q

iterations``R \
=``] ^
$num``_ b
)``b c
=>aa 
GenerateHashaa 
(aa 
UTF8Encodingaa (
.aa( )
UTF8aa) -
.aa- .
GetBytesaa. 6
(aa6 7
passwordaa7 ?
)aa? @
,aa@ A
saltaaB F
,aaF G
lengthaaH N
,aaN O

iterationsaaP Z
)aaZ [
;aa[ \
privatecc 
(cc 
bytecc 
[cc 
]cc 
,cc 
bytecc 
[cc 
]cc 
)cc  
GenerateHashcc! -
(cc- .
stringcc. 4
passwordcc5 =
,cc= >
intcc? B

saltLengthccC M
,ccM N
intccO R

hashLengthccS ]
,cc] ^
intcc_ b

iterationsccc m
=ccn o
$numccp s
)ccs t
{dd 	
varee 
saltee 
=ee 
GenerateSaltee #
(ee# $

saltLengthee$ .
)ee. /
;ee/ 0
returnff 
(ff 
GenerateHashff  
(ff  !
passwordff! )
,ff) *
saltff+ /
,ff/ 0

hashLengthff1 ;
,ff; <

iterationsff= G
)ffG H
,ffH I
saltffJ N
)ffN O
;ffO P
}gg 	
publicii 
asyncii 
Taskii 
<ii 
	IResponseii #
<ii# $
PasswordRecordii$ 2
>ii2 3
>ii3 4
Authenticateii5 A
(iiA B
PasswordRequestiiB Q
requestiiR Y
)iiY Z
{jj 	
varkk 
responsekk 
=kk 
newkk 
MethodResponsekk -
<kk- .
PasswordRecordkk. <
>kk< =
(kk= >
)kk> ?
;kk? @
responsemm 
.mm 
Datamm 
=mm 
(mm 
awaitmm " 
_passwordsRepositorymm# 7
.mm7 8
Readmm8 <
(mm< =
xmm= >
=>mm? A
xmmB C
.mmC D
UserNamemmD L
==mmM O
requestmmP W
.mmW X
UserNamemmX `
)mm` a
)mma b
?mmb c
.mmc d
FirstOrDefaultmmd r
(mmr s
)mms t
;mmt u
ifnn 
(nn 
responsenn 
.nn 
Datann 
==nn  
nullnn! %
)nn% &
{oo 
responsepp 
.pp 
Sucesspp 
=pp  !
falsepp" '
;pp' (
responseqq 
.qq 
Errorsqq 
=qq  !
newqq" %
Listqq& *
<qq* +
ErrorResponseqq+ 8
>qq8 9
(qq9 :
)qq: ;
{rr 
newss 
ErrorResponsess %
(ss% &
)ss& '
{ss' (
Messagess) 0
=ss1 2
$"ss3 5
$strss5 W
{ssW X
requestssX _
.ss_ `
UserNamess` h
}ssh i
"ssi j
}ssj k
}tt 
;tt 
returnuu 
responseuu 
;uu  
}vv 
varxx 
requestHashxx 
=xx 
GenerateHashxx *
(xx* +
requestxx+ 2
.xx2 3
Passwordxx3 ;
,xx; <
responsexx= E
.xxE F
DataxxF J
.xxJ K
SaltxxK O
,xxO P
responsexxQ Y
.xxY Z
DataxxZ ^
.xx^ _

HashLengthxx_ i
,xxi j
responsexxk s
.xxs t
Dataxxt x
.xxx y

Iterations	xxy É
)
xxÉ Ñ
;
xxÑ Ö
responseyy 
.yy 
Sucessyy 
=yy 
requestHashyy )
.yy) *

BytesEqualyy* 4
(yy4 5
responseyy5 =
.yy= >
Datayy> B
.yyB C
PasswordHashyyC O
)yyO P
;yyP Q
if{{ 
({{ 
!{{ 
response{{ 
.{{ 
Sucess{{  
){{  !
{|| 
response}} 
.}} 
Data}} 
=}} 
null}}  $
;}}$ %
response~~ 
.~~ 
Errors~~ 
=~~  !
new~~" %
List~~& *
<~~* +
ErrorResponse~~+ 8
>~~8 9
(~~9 :
)~~: ;
{ 
new
ÄÄ 
ErrorResponse
ÄÄ %
(
ÄÄ% &
)
ÄÄ& '
{
ÄÄ' (
Message
ÄÄ) 0
=
ÄÄ1 2
$"
ÄÄ3 5
$str
ÄÄ5 [
{
ÄÄ[ \
request
ÄÄ\ c
.
ÄÄc d
UserName
ÄÄd l
}
ÄÄl m
"
ÄÄm n
}
ÄÄn o
}
ÅÅ 
;
ÅÅ 
return
ÇÇ 
response
ÇÇ 
;
ÇÇ  
}
ÉÉ 
return
ÖÖ 
response
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
}
áá 
}àà ⁄
9D:\Repos\CommonCore\CommonCore2\Loaders\JWTTokenLoader.cs
	namespace 	
CommonCore2
 
. 
Loaders 
{ 
public 

class 
JWTTokenLoader 
:  !%
IAuthorizationTokenLoader" ;
{ 
private 
readonly 
string 
_key  $
;$ %
private 
readonly 
string 
_issuer  '
;' (
public 
JWTTokenLoader 
( 
IConfiguration 
configuration (
) 
{ 	
_key 
= 
configuration  
.  !
GetValue! )
<) *
string* 0
>0 1
(1 2
$str2 ;
); <
;< =
_issuer 
= 
configuration #
.# $
GetValue$ ,
<, -
string- 3
>3 4
(4 5
$str5 A
)A B
;B C
} 	
public 
async 
Task 
< 
	IResponse #
<# $
string$ *
>* +
>+ ,
GetToken- 5
(5 6
PasswordRecord6 D
recordE K
)K L
{ 	
if   
(   
record   
.   
Claims   
==    
null  ! %
)  % &
record!! 
.!! 
Claims!! 
=!! 
new!!  #
List!!$ (
<!!( )
Claim!!) .
>!!. /
(!!/ 0
)!!0 1
;!!1 2
if"" 
("" 
!"" 
record"" 
."" 
Claims"" 
."" 
Contains"" '
(""' (
x""( )
=>""* ,
x""- .
."". /
Type""/ 3
==""4 6

ClaimTypes""7 A
.""A B
Name""B F
)""F G
)""G H
record## 
.## 
Claims## 
.## 
Add## !
(##! "
new##" %
Claim##& +
(##+ ,

ClaimTypes##, 6
.##6 7
Name##7 ;
,##; <
record##= C
.##C D
UserName##D L
)##L M
)##M N
;##N O
var%% 
result%% 
=%% 
new%% 
MethodResponse%% +
<%%+ ,
string%%, 2
>%%2 3
(%%3 4
)%%4 5
.&& 
AsSucces&& %
(&&% &
)&&& '
;&&' (
var(( 
securityKey(( 
=(( 
new(( ! 
SymmetricSecurityKey((" 6
(((6 7
Encoding((7 ?
.((? @
UTF8((@ D
.((D E
GetBytes((E M
(((M N
_key((N R
)((R S
)((S T
;((T U
var)) 
credentials)) 
=)) 
new)) !
SigningCredentials))" 4
())4 5
securityKey))5 @
,))@ A
SecurityAlgorithms))B T
.))T U

HmacSha256))U _
)))_ `
;))` a
var++ 
token++ 
=++ 
new++ 
JwtSecurityToken++ ,
(++, -
_issuer,, 
,,, 
_issuer-- 
,-- 
record.. 
... 
Claims.. 
,.. 
expires// 
:// 
DateTime// !
.//! "
Now//" %
.//% &

AddMinutes//& 0
(//0 1
$num//1 4
)//4 5
,//5 6
signingCredentials00 "
:00" #
credentials00$ /
)11 
;11 
result33 
.33 
Data33 
=33 
new33 #
JwtSecurityTokenHandler33 5
(335 6
)336 7
.337 8

WriteToken338 B
(33B C
token33C H
)33H I
;33I J
return55 
result55 
;55 
}66 	
}77 
}88 ¶<
BD:\Repos\CommonCore\CommonCore2\Mathematics\HaversineCalculator.cs
	namespace 	
CommonCore2
 
. 
Mathematics !
{ 
public 

class 
HaversineCalculator $
{ 
public 
double 
AdjustBetween0And1 (
(( )
double) /
x0 1
)1 2
{ 	
while 
( 
x 
< 
$num 
) 
x 
++ 
; 
while 
( 
x 
> 
$num 
) 
x 
-- 
; 
return 
x 
; 
} 	
public 
double 
	Haversine 
(  
double  &
x' (
)( )
=> 
Math 
. 
Pow 
( 
Math 
. 
Sin  
(  !
x! "
/# $
$num% &
)& '
,' (
$num) *
)* +
;+ ,
public 
double 
ArcHaversine "
(" #
double# )
	haversine* 3
)3 4
=>5 7
Math8 <
.< =
Asin= A
(A B
MathB F
.F G
SqrtG K
(K L
	haversineL U
)U V
)V W
*X Y
$numZ [
;[ \
public 
double 
	ToRadians 
(  
double  &
x' (
)( )
=>* ,
x- .
*/ 0
(1 2
Math2 6
.6 7
PI7 9
/: ;
$num< ?
)? @
;@ A
public 
double 
	ToDegrees 
(  
double  &
x' (
)( )
=>* ,
x- .
// 0
(1 2
Math2 6
.6 7
PI7 9
/: ;
$num< ?
)? @
;@ A
public   
double   
Distance   
(   
double   %
lat1  & *
,  * +
double  , 2
lat2  3 7
,  7 8
double  9 ?
lon1  @ D
,  D E
double  F L
lon2  M Q
)  Q R
{!! 	
var"" 
tLat1"" 
="" 
	ToRadians"" !
(""! "
lat1""" &
)""& '
;""' (
var## 
tLat2## 
=## 
	ToRadians## !
(##! "
lat2##" &
)##& '
;##' (
double%% 
dLat%% 
=%% 
	ToRadians%% #
(%%# $
lat2%%$ (
-%%) *
lat1%%+ /
)%%/ 0
;%%0 1
double&& 
dLon&& 
=&& 
	ToRadians&& #
(&&# $
lon2&&$ (
-&&) *
lon1&&+ /
)&&/ 0
;&&0 1
double(( 
h(( 
=(( 
	Haversine((  
(((  !
dLat((! %
)((% &
+((' (
((() *
Math((* .
.((. /
Cos((/ 2
(((2 3
tLat1((3 8
)((8 9
*((: ;
Math((< @
.((@ A
Cos((A D
(((D E
tLat2((E J
)((J K
*((L M
	Haversine((N W
(((W X
dLon((X \
)((\ ]
)((] ^
;((^ _
var** 
result** 
=** 
ArcHaversine** %
(**% &
h**& '
)**' (
;**( )
return++ 
result++ 
;++ 
},, 	
public.. 
double.. 

DistanceKm..  
(..  !
double..! '
lat1..( ,
,.., -
double... 4
lat2..5 9
,..9 :
double..; A
lon1..B F
,..F G
double..H N
lon2..O S
)..S T
=>// 
$num// 
*// 
Distance// 
(// 
lat1// #
,//# $
lat2//% )
,//) *
lon1//+ /
,/// 0
lon2//1 5
)//5 6
;//6 7
public11 
double11 
DistanceMiles11 #
(11# $
double11$ *
lat111+ /
,11/ 0
double111 7
lat2118 <
,11< =
double11> D
lon111E I
,11I J
double11K Q
lon211R V
)11V W
=>22 
$num22 
*22 
Distance22 "
(22" #
lat122# '
,22' (
lat222) -
,22- .
lon122/ 3
,223 4
lon2225 9
)229 :
;22: ;
public55 
double55 

Longitude255  
(55  !
double55! '
distance55( 0
,550 1
double552 8
lat1559 =
,55= >
double55? E
lat255F J
,55J K
double55L R
lon155S W
)55W X
{66 	
var77 
h77 
=77 
	Haversine77 
(77 
distance77 &
)77& '
;77' (
var88 
tLat188 
=88 
	ToRadians88 !
(88! "
lat188" &
)88& '
;88' (
var99 
tLat299 
=99 
	ToRadians99 !
(99! "
lat299" &
)99& '
;99' (
var:: 
dLat:: 
=:: 
	ToRadians::  
(::  !
lat2::! %
-::& '
lat1::( ,
)::, -
;::- .
var<< 
b<< 
=<< 
(<< 
h<< 
-<< 
	Haversine<< "
(<<" #
dLat<<# '
)<<' (
)<<( )
/<<* +
(<<, -
Math<<- 1
.<<1 2
Cos<<2 5
(<<5 6
tLat1<<6 ;
)<<; <
*<<= >
Math<<? C
.<<C D
Cos<<D G
(<<G H
tLat2<<H M
)<<M N
)<<N O
;<<O P
var>> 
dLon>> 
=>> 
ArcHaversine>> #
(>># $
b>>$ %
)>>% &
;>>& '
var?? 
dLonDeg?? 
=?? 
	ToDegrees?? #
(??# $
dLon??$ (
)??( )
;??) *
var@@ 
result@@ 
=@@ 
dLonDeg@@  
+@@! "
lon1@@# '
;@@' (
returnAA 
resultAA 
;AA 
}BB 	
publicDD 
doubleDD 
Longitude2KmDD "
(DD" #
doubleDD# )
distanceDD* 2
,DD2 3
doubleDD4 :
lat1DD; ?
,DD? @
doubleDDA G
lat2DDH L
,DDL M
doubleDDN T
lon1DDU Y
)DDY Z
=>EE 

Longitude2EE 
(EE 
distanceEE "
/EE# $
$numEE% )
,EE) *
lat1EE+ /
,EE/ 0
lat2EE1 5
,EE5 6
lon1EE7 ;
)EE; <
;EE< =
publicGG 
doubleGG 
Longitude2MilesGG %
(GG% &
doubleGG& ,
distanceGG- 5
,GG5 6
doubleGG7 =
lat1GG> B
,GGB C
doubleGGD J
lat2GGK O
,GGO P
doubleGGQ W
lon1GGX \
)GG\ ]
=>HH 

Longitude2HH 
(HH 
distanceHH "
/HH# $
$numHH% -
,HH- .
lat1HH/ 3
,HH3 4
lat2HH5 9
,HH9 :
lon1HH; ?
)HH? @
;HH@ A
}II 
}JJ á
=D:\Repos\CommonCore\CommonCore2\Mathematics\MathExtensions.cs
	namespace 	
CommonCore2
 
. 
Mathematics !
{ 
public 

static 
class 
MathExtensions &
{ 
public 
static 
double 
	ToRadians &
(& '
this' +
double, 2
degrees3 :
): ;
{ 	
return		 
degrees		 
*		 
Math		 !
.		! "
PI		" $
/		% &
$num		' *
;		* +
}

 	
} 
} èE
KD:\Repos\CommonCore\CommonCore2\Repository\MongoDb\MongoDbCrudRepository.cs
	namespace

 	
CommonCore2


 
.

 

Repository

  
.

  !
MongoDb

! (
{ 
public 

class !
MongoDbCrudRepository &
<& '
T' (
>( )
:* +
ICrudRepository, ;
<; <
T< =
>= >
{ 
private 
readonly 
MongoUrl !
_url" &
;& '
private 
readonly 
IMongoClient %
_client& -
;- .
private 
readonly 
IMongoDatabase '
	_database( 1
;1 2
internal !
MongoDbCrudRepository &
(& '
string' -
connectionString. >
)> ?
{ 	
_url 
= 
new 
MongoUrl 
(  
connectionString  0
)0 1
;1 2
_client 
= 
new 
MongoClient %
(% &
_url& *
)* +
;+ ,
	_database 
= 
_client 
.  
GetDatabase  +
(+ ,
_url, 0
.0 1
DatabaseName1 =
)= >
;> ?
} 	
private 
IMongoCollection  
<  !
T! "
>" #
GetCollection$ 1
<1 2
T2 3
>3 4
(4 5
)5 6
=> 
	_database 
. 
GetCollection &
<& '
T' (
>( )
() *
typeof* 0
(0 1
T1 2
)2 3
.3 4
Name4 8
)8 9
;9 :
public 
async 
Task 
Create  
(  !
T! "
item# '
)' (
{ 	
var 

collection 
= 
GetCollection *
<* +
T+ ,
>, -
(- .
). /
;/ 0
await 

collection 
. 
InsertOneAsync +
(+ ,
item, 0
)0 1
;1 2
}   	
public"" 
async"" 
Task"" 
Create""  
(""  !
IEnumerable""! ,
<"", -
T""- .
>"". /
items""0 5
)""5 6
{## 	
var$$ 

collection$$ 
=$$ 
GetCollection$$ *
<$$* +
T$$+ ,
>$$, -
($$- .
)$$. /
;$$/ 0
await%% 

collection%% 
.%% 
InsertManyAsync%% ,
(%%, -
items%%- 2
)%%2 3
;%%3 4
}&& 	
public(( 
async(( 
Task(( 
<(( 
IEnumerable(( %
<((% &
T((& '
>((' (
>((( )
Read((* .
(((. /

Expression((/ 9
<((9 :
Func((: >
<((> ?
T((? @
,((@ A
bool((B F
>((F G
>((G H
filter((I O
)((O P
{)) 	
var** 

collection** 
=** 
GetCollection** *
<*** +
T**+ ,
>**, -
(**- .
)**. /
;**/ 0
var++ 
cursor++ 
=++ 
await++ 

collection++ )
.++) *
	FindAsync++* 3
<++3 4
T++4 5
>++5 6
(++6 7
filter++7 =
)++= >
;++> ?
return,, 
cursor,, 
.,, 
ToEnumerable,, &
<,,& '
T,,' (
>,,( )
(,,) *
),,* +
;,,+ ,
}-- 	
public// 
async// 
Task// 
<// 
IEnumerable// %
<//% &
T//& '
>//' (
>//( )
Read//* .
(//. /
SearchRequest/// <
<//< =
T//= >
>//> ?
searchRequest//@ M
)//M N
{00 	
var11 

collection11 
=11 
GetCollection11 *
<11* +
T11+ ,
>11, -
(11- .
)11. /
;11/ 0
var22 
cursor22 
=22 
await22 

collection22 )
.22) *
	FindAsync22* 3
<223 4
T224 5
>225 6
(226 7
searchRequest227 D
.22D E
Filter22E K
,22K L
new22M P
FindOptions22Q \
<22\ ]
T22] ^
>22^ _
(22_ `
)22` a
{33 
Limit44 
=44 
searchRequest44 %
.44% &
Limit44& +
,44+ ,
Skip55 
=55 
searchRequest55 $
.55$ %
Skip55% )
}66 
)66 
;66 
return77 
cursor77 
.77 
ToEnumerable77 &
<77& '
T77' (
>77( )
(77) *
)77* +
;77+ ,
}88 	
public:: 
async:: 
Task:: 
<:: 
(:: 
bool:: 
,::  
T::! "
)::" #
>::# $
Update::% +
(::+ ,
T::, -
item::. 2
,::2 3

Expression::4 >
<::> ?
Func::? C
<::C D
T::D E
,::E F
bool::G K
>::K L
>::L M
filter::N T
)::T U
{;; 	
var<< 

collection<< 
=<< 
GetCollection<< *
<<<* +
T<<+ ,
><<, -
(<<- .
)<<. /
;<</ 0
var== 
updateResult== 
=== 
await== $

collection==% /
.==/ 0
ReplaceOneAsync==0 ?
<==? @
T==@ A
>==A B
(==B C
filter==C I
,==I J
item==K O
)==O P
;==P Q
return>> 
(>> 
updateResult>>  
.>>  !
IsAcknowledged>>! /
,>>/ 0
item>>1 5
)>>5 6
;>>6 7
}?? 	
publicAA 
asyncAA 
TaskAA 
<AA 
boolAA 
>AA 
DeleteAA  &
(AA& '

ExpressionAA' 1
<AA1 2
FuncAA2 6
<AA6 7
TAA7 8
,AA8 9
boolAA: >
>AA> ?
>AA? @

expressionAAA K
)AAK L
{BB 	
varCC 

collectionCC 
=CC 
GetCollectionCC *
<CC* +
TCC+ ,
>CC, -
(CC- .
)CC. /
;CC/ 0
varDD 
deleteResultDD 
=DD 
awaitDD $

collectionDD% /
.DD/ 0
DeleteOneAsyncDD0 >
<DD> ?
TDD? @
>DD@ A
(DDA B

expressionDDB L
)DDL M
;DDM N
returnEE 
deleteResultEE 
.EE  
IsAcknowledgedEE  .
;EE. /
}FF 	
publicHH 
asyncHH 
TaskHH 
<HH 
boolHH 
>HH 

DeleteBulkHH  *
(HH* +

ExpressionHH+ 5
<HH5 6
FuncHH6 :
<HH: ;
THH; <
,HH< =
boolHH> B
>HHB C
>HHC D
filterHHE K
)HHK L
{II 	
varJJ 

collectionJJ 
=JJ 
GetCollectionJJ *
<JJ* +
TJJ+ ,
>JJ, -
(JJ- .
)JJ. /
;JJ/ 0
varKK 
deleteResultKK 
=KK 
awaitKK $

collectionKK% /
.KK/ 0
DeleteManyAsyncKK0 ?
<KK? @
TKK@ A
>KKA B
(KKB C
filterKKC I
)KKI J
;KKJ K
returnLL 
deleteResultLL 
.LL  
IsAcknowledgedLL  .
;LL. /
}MM 	
publicOO 
asyncOO 
TaskOO 
<OO 
TOO 
>OO 
FirstOO "
(OO" #

ExpressionOO# -
<OO- .
FuncOO. 2
<OO2 3
TOO3 4
,OO4 5
boolOO6 :
>OO: ;
>OO; <
filterOO= C
)OOC D
{PP 	
varQQ 
	resultSetQQ 
=QQ 
awaitQQ !
ReadQQ" &
(QQ& '
filterQQ' -
)QQ- .
;QQ. /
returnRR 
	resultSetRR 
.RR 
AsEnumerableRR )
(RR) *
)RR* +
.RR+ ,
FirstOrDefaultRR, :
(RR: ;
)RR; <
;RR< =
}SS 	
}TT 
}UU Ù
RD:\Repos\CommonCore\CommonCore2\Repository\MongoDb\MongoDbCrudRepositoryFactory.cs
	namespace 	
CommonCore2
 
. 

Repository  
.  !
MongoDb! (
{ 
public 

class (
MongoDbCrudRepositoryFactory -
:. /"
ICrudRepositoryFactory0 F
{ 
private 
readonly 
string 
_connectionString  1
;1 2
public		 (
MongoDbCrudRepositoryFactory		 +
(		+ ,
string

 
connectionString

 #
) 
{ 	
_connectionString 
= 
connectionString  0
;0 1
} 	
public 
ICrudRepository 
< 
T  
>  !
Get" %
<% &
T& '
>' (
(( )
)) *
=> 
new !
MongoDbCrudRepository (
<( )
T) *
>* +
(+ ,
_connectionString, =
)= >
;> ?
} 
} ¥
4D:\Repos\CommonCore\CommonCore2\RuleTrees\AndRule.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

class 
AndRule 
: 
RuleNode #
{ 
public 
AndRule 
( 
) 
: 
base 
( 
) 
{ 
} 
public

 
AndRule

 
(

 
params

 
RuleNode

 &
[

& '
]

' (
	ruleNodes

) 2
)

2 3
: 
base 
( 
	ruleNodes 
) 
{ 
}  !
public 
async 
override 
Task "
<" #
bool# '
>' (
Passes) /
(/ 0
)0 1
=> 
await 
RuleTree 
. 
	PassesAnd '
(' (
Children( 0
)0 1
;1 2
} 
} â
FD:\Repos\CommonCore\CommonCore2\RuleTrees\Comparison\ComparisonRule.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
.  

Comparison  *
{ 
public 

abstract 
class 
ComparisonRule (
<( )
T) *
>* +
:, -
SearchParameterRule. A
{ 
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
public 
T 
OwnValue 
{ 
get 
;  
set! $
;$ %
}& '
public

 "
ComparisonOperatorEnum

 %
Operator

& .
{

/ 0
get

1 4
;

4 5
set

6 9
;

9 :
}

; <
	protected 
ComparisonRule  
(  !
)! "
:# $
base% )
() *
)* +
{ 	
} 	
	protected 
ComparisonRule  
(  !
T! "
ownValue# +
)+ ,
{ 	
OwnValue 
= 
ownValue 
;  
} 	
	protected 
ComparisonRule  
(  !
T! "
ownValue# +
,+ ,
T- .
comparisonValue/ >
)> ?
{ 	
OwnValue 
= 
ownValue 
;  
ComparisonValue 
= 
comparisonValue -
;- .
} 	
} 
} ™B
MD:\Repos\CommonCore\CommonCore2\RuleTrees\Comparison\GenericComparisonRule.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
.  

Comparison  *
{ 
public 

class !
GenericComparisonRule &
<& '
T2' )
>) *
:+ ,
ComparisonRule- ;
<; <
T2< >
>> ?
where		 
T2		 
:		 
IComparable		 
<		 
T2		 !
>		! "
{

 
public !
GenericComparisonRule $
($ %
)% &
:' (
base) -
(- .
). /
{ 	
} 	
public !
GenericComparisonRule $
($ %
T2% '
ownValue( 0
)0 1
:2 3
base4 8
(8 9
ownValue9 A
)A B
{ 	
} 	
public !
GenericComparisonRule $
($ %
T2% '
ownValue( 0
,0 1
T22 4
comparisonValue5 D
)D E
:F G
baseH L
(L M
ownValueM U
,U V
comparisonValueW f
)f g
{ 	
} 	
public 
async 
override 
Task "
<" #
bool# '
>' (
Passes) /
(/ 0
)0 1
{ 	
bool 
result 
= 
false 
;  
if 
( 
ComparisonValue 
is  "
T2# %
comparisonValue& 5
)5 6
{ 
switch 
( 
Operator  
)  !
{ 
case   "
ComparisonOperatorEnum   /
.  / 0
LessThan  0 8
:  8 9
result!! 
=!!  
OwnValue!!! )
.!!) *

IsLessThan!!* 4
<!!4 5
T2!!5 7
>!!7 8
(!!8 9
comparisonValue!!9 H
)!!H I
;!!I J
break"" 
;"" 
case## "
ComparisonOperatorEnum## /
.##/ 0
LessThanOrEqualTo##0 A
:##A B
result$$ 
=$$  
OwnValue$$! )
.$$) *
IsLessThanOrEqualTo$$* =
<$$= >
T2$$> @
>$$@ A
($$A B
comparisonValue$$B Q
)$$Q R
;$$R S
break%% 
;%% 
case&& "
ComparisonOperatorEnum&& /
.&&/ 0
EqualTo&&0 7
:&&7 8
result'' 
=''  
OwnValue''! )
.'') *
	IsEqualTo''* 3
<''3 4
T2''4 6
>''6 7
(''7 8
comparisonValue''8 G
)''G H
;''H I
break(( 
;(( 
case)) "
ComparisonOperatorEnum)) /
.))/ 0 
GreaterThanOrEqualTo))0 D
:))D E
result** 
=**  
OwnValue**! )
.**) *"
IsGreaterThanOrEqualTo*** @
<**@ A
T2**A C
>**C D
(**D E
comparisonValue**E T
)**T U
;**U V
break++ 
;++ 
case,, "
ComparisonOperatorEnum,, /
.,,/ 0
GreaterThan,,0 ;
:,,; <
result-- 
=--  
OwnValue--! )
.--) *
IsGreaterThan--* 7
<--7 8
T2--8 :
>--: ;
(--; <
comparisonValue--< K
)--K L
;--L M
break.. 
;.. 
case// "
ComparisonOperatorEnum// /
./// 0

NotEqualTo//0 :
://: ;
result00 
=00  
OwnValue00! )
.00) *
IsNotEqualTo00* 6
<006 7
T2007 9
>009 :
(00: ;
comparisonValue00; J
)00J K
;00K L
break11 
;11 
default22 
:22 
result33 
=33  
OwnValue33! )
.33) *
	IsEqualTo33* 3
<333 4
T2334 6
>336 7
(337 8
comparisonValue338 G
)33G H
;33H I
break44 
;44 
}55 
}66 
return77 
result77 
&&88 
await88 
RuleTree88 !
.88! "
	PassesAnd88" +
(88+ ,
Children88, 4
)884 5
;885 6
}99 	
}:: 
public<< 

class<< !
GenericComparisonRule<< &
:<<' (
ComparisonRule<<) 7
<<<7 8
IComparable<<8 C
><<C D
{== 
public>> !
GenericComparisonRule>> $
(>>$ %
)>>% &
:>>' (
base>>) -
(>>- .
)>>. /
{?? 	
}@@ 	
publicBB !
GenericComparisonRuleBB $
(BB$ %
IComparableBB% 0
ownValueBB1 9
)BB9 :
:BB; <
baseBB= A
(BBA B
ownValueBBB J
)BBJ K
{CC 	
}DD 	
publicFF !
GenericComparisonRuleFF $
(FF$ %
IComparableFF% 0
ownValueFF1 9
,FF9 :
IComparableFF; F
comparisonValueFFG V
)FFV W
:FFX Y
baseFFZ ^
(FF^ _
ownValueFF_ g
,FFg h
comparisonValueFFi x
)FFx y
{GG 	
}HH 	
publicJJ 
asyncJJ 
overrideJJ 
TaskJJ "
<JJ" #
boolJJ# '
>JJ' (
PassesJJ) /
(JJ/ 0
)JJ0 1
{KK 	
boolLL 
resultLL 
=LL 
falseLL 
;LL  
ifNN 
(NN 
ComparisonValueNN 
isNN  "
IComparableNN# .
comparisonValueNN/ >
)NN> ?
{OO 
switchPP 
(PP 
OperatorPP  
)PP  !
{QQ 
caseRR "
ComparisonOperatorEnumRR /
.RR/ 0
LessThanRR0 8
:RR8 9
resultSS 
=SS  
OwnValueSS! )
.SS) *

IsLessThanSS* 4
(SS4 5
comparisonValueSS5 D
)SSD E
;SSE F
breakTT 
;TT 
caseUU "
ComparisonOperatorEnumUU /
.UU/ 0
LessThanOrEqualToUU0 A
:UUA B
resultVV 
=VV  
OwnValueVV! )
.VV) *
IsLessThanOrEqualToVV* =
(VV= >
comparisonValueVV> M
)VVM N
;VVN O
breakWW 
;WW 
caseXX "
ComparisonOperatorEnumXX /
.XX/ 0
EqualToXX0 7
:XX7 8
resultYY 
=YY  
OwnValueYY! )
.YY) *
	IsEqualToYY* 3
(YY3 4
comparisonValueYY4 C
)YYC D
;YYD E
breakZZ 
;ZZ 
case[[ "
ComparisonOperatorEnum[[ /
.[[/ 0 
GreaterThanOrEqualTo[[0 D
:[[D E
result\\ 
=\\  
OwnValue\\! )
.\\) *"
IsGreaterThanOrEqualTo\\* @
(\\@ A
comparisonValue\\A P
)\\P Q
;\\Q R
break]] 
;]] 
case^^ "
ComparisonOperatorEnum^^ /
.^^/ 0
GreaterThan^^0 ;
:^^; <
result__ 
=__  
OwnValue__! )
.__) *
IsGreaterThan__* 7
(__7 8
comparisonValue__8 G
)__G H
;__H I
break`` 
;`` 
caseaa "
ComparisonOperatorEnumaa /
.aa/ 0

NotEqualToaa0 :
:aa: ;
resultbb 
=bb  
OwnValuebb! )
.bb) *
IsNotEqualTobb* 6
(bb6 7
comparisonValuebb7 F
)bbF G
;bbG H
breakcc 
;cc 
defaultdd 
:dd 
resultee 
=ee  
OwnValueee! )
.ee) *
	IsEqualToee* 3
(ee3 4
comparisonValueee4 C
)eeC D
;eeD E
breakff 
;ff 
}gg 
}hh 
returnii 
resultii 
&&jj 
awaitjj 
RuleTreejj !
.jj! "
	PassesAndjj" +
(jj+ ,
Childrenjj, 4
)jj4 5
;jj5 6
}kk 	
}nn 
}pp ˙

DD:\Repos\CommonCore\CommonCore2\RuleTrees\DictionaryValueProvider.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

class #
DictionaryValueProvider (
:) *"
IRuleTreeValueProvider+ A
{ 
private		 
readonly		 
IDictionary		 $
<		$ %
string		% +
,		+ ,
object		- 3
>		3 4
_source		5 <
;		< =
public #
DictionaryValueProvider &
(& '
IDictionary 
< 
string 
, 
object  &
>& '
source( .
) 
{ 	
_source 
= 
source 
; 
} 	
public 
async 
Task 
< 
object  
>  !
GetValue" *
(* +
string+ 1
key2 5
)5 6
{ 	
if 
( 
_source 
. 
TryGetValue #
(# $
key$ '
,' (
out) ,
object- 3
value4 9
)9 :
): ;
return 
value 
; 
return 
null 
; 
} 	
} 
} ƒ
JD:\Repos\CommonCore\CommonCore2\RuleTrees\ExclusiveRangeSearchParameter.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

class )
ExclusiveRangeSearchParameter .
:/ 0
SearchParameterRule1 D
{ 
public		 
IComparable		 
From		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 
IComparable

 
To

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
async 
override 
Task "
<" #
bool# '
>' (
Passes) /
(/ 0
)0 1
{ 	
bool 
result 
= 
false 
;  
if 
( 
ComparisonValue 
is  "
IComparable# .
comparisonValue/ >
)> ?
{ 
result 
= 
comparisonValue (
.( )
IsGreaterThan) 6
(6 7
From7 ;
); <
&& 
comparisonValue "
." #

IsLessThan# -
(- .
To. 0
)0 1
;1 2
} 
return 
result 
&& 
await "
RuleTree# +
.+ ,
	PassesAnd, 5
(5 6
Children6 >
)> ?
;? @
} 	
} 
public 

class )
ExclusiveRangeSearchParameter .
<. /
T/ 0
>0 1
:2 3
SearchParameterRule4 G
{ 
public 
T 
From 
{ 
get 
; 
set  
;  !
}" #
public 
T 
To 
{ 
get 
; 
set 
; 
}  !
public 
async 
override 
Task "
<" #
bool# '
>' (
Passes) /
(/ 0
)0 1
{ 	
bool   
result   
=   
false   
;    
if!! 
(!! 
ComparisonValue!! 
is!!  "
IComparable!!# .
<!!. /
T!!/ 0
>!!0 1
comparisonValue!!2 A
)!!A B
{"" 
result## 
=## 
comparisonValue## (
.##( )
IsGreaterThan##) 6
(##6 7
From##7 ;
)##; <
&&$$ 
comparisonValue$$ "
.$$" #

IsLessThan$$# -
($$- .
To$$. 0
)$$0 1
;$$1 2
}%% 
return'' 
result'' 
&&'' 
await'' "
RuleTree''# +
.''+ ,
	PassesAnd'', 5
(''5 6
Children''6 >
)''> ?
;''? @
}(( 	
})) 
}** ≈
5D:\Repos\CommonCore\CommonCore2\RuleTrees\FuncRule.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

class 
FuncRule 
: 
RuleNode $
{ 
private 
readonly 
Func 
< 
bool "
>" #
_func$ )
;) *
public

 
FuncRule

 
(

 
Func 
< 
bool 
> 
func 
) 
{ 	
_func 
= 
func 
; 
} 	
public 
override 
async 
Task "
<" #
bool# '
>' (
Passes) /
(/ 0
)0 1
=> 
_func 
( 
) 
&& 
await  
RuleTree! )
.) *
	PassesAnd* 3
(3 4
Children4 <
)< =
;= >
} 
} Ë
JD:\Repos\CommonCore\CommonCore2\RuleTrees\InclusiveRangeSearchParameter.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

class )
InclusiveRangeSearchParameter .
:/ 0
SearchParameterRule1 D
{ 
public		 
IComparable		 
From		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 
IComparable

 
To

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
async 
override 
Task "
<" #
bool# '
>' (
Passes) /
(/ 0
)0 1
{ 	
bool 
result 
= 
false 
;  
if 
( 
ComparisonValue 
is  "
IComparable# .
comparisonValue/ >
)> ?
{ 
result 
= 
comparisonValue (
.( )"
IsGreaterThanOrEqualTo) ?
(? @
From@ D
)D E
&& 
comparisonValue "
." #
IsLessThanOrEqualTo# 6
(6 7
To7 9
)9 :
;: ;
} 
return 
result 
&& 
await "
RuleTree# +
.+ ,
	PassesAnd, 5
(5 6
Children6 >
)> ?
;? @
} 	
} 
public 

class )
InclusiveRangeSearchParameter .
<. /
T/ 0
>0 1
:2 3
SearchParameterRule4 G
{ 
public 
T 
From 
{ 
get 
; 
set  
;  !
}" #
public 
T 
To 
{ 
get 
; 
set 
; 
}  !
public 
async 
override 
Task "
<" #
bool# '
>' (
Passes) /
(/ 0
)0 1
{ 	
bool   
result   
=   
false   
;    
if!! 
(!! 
ComparisonValue!! 
is!!  "
IComparable!!# .
<!!. /
T!!/ 0
>!!0 1
comparisonValue!!2 A
)!!A B
{"" 
result## 
=## 
comparisonValue## (
.##( )"
IsGreaterThanOrEqualTo##) ?
(##? @
From##@ D
)##D E
&&$$ 
comparisonValue$$ "
.$$" #
IsLessThanOrEqualTo$$# 6
($$6 7
To$$7 9
)$$9 :
;$$: ;
}%% 
return'' 
result'' 
&&'' 
await'' "
RuleTree''# +
.''+ ,
	PassesAnd'', 5
(''5 6
Children''6 >
)''> ?
;''? @
}(( 	
})) 
}** ÿ
CD:\Repos\CommonCore\CommonCore2\RuleTrees\OptionsSearchParameter.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

class "
OptionsSearchParameter '
<' (
T( )
>) *
:+ ,
SearchParameterRule- @
{ 
public 
List 
< 
T 
> 
Set 
{ 
get  
;  !
set" %
;% &
}' (
public

 
override

 
async

 
Task

 "
<

" #
bool

# '
>

' (
Passes

) /
(

/ 0
)

0 1
{ 	
bool 
result 
= 
false 
;  
if 
( 
ComparisonValue 
is  "
T# $
comparisonValue% 4
)4 5
{ 
result 
= 
Set 
? 
. 
Contains &
(& '
comparisonValue' 6
)6 7
??8 :
false; @
;@ A
} 
return 
result 
&& 
await "
RuleTree# +
.+ ,
	PassesAnd, 5
(5 6
Children6 >
)> ?
;? @
} 	
public "
OptionsSearchParameter %
(% &
)& '
:( )
base* .
(. /
)/ 0
{ 	
} 	
} 
} Ø
3D:\Repos\CommonCore\CommonCore2\RuleTrees\OrRule.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

class 
OrRule 
: 
RuleNode "
{ 
public 
OrRule 
( 
) 
: 
base 
( 
) 
{ 
} 
public

 
OrRule

 
(

 
params

 
RuleNode

 %
[

% &
]

& '
	ruleNodes

( 1
)

1 2
: 
base 
( 
	ruleNodes 
) 
{ 
}  !
public 
async 
override 
Task "
<" #
bool# '
>' (
Passes) /
(/ 0
)0 1
=> 
await 
RuleTree 
. 
PassesOr &
(& '
Children' /
)/ 0
;0 1
} 
} Ë
5D:\Repos\CommonCore\CommonCore2\RuleTrees\RuleNode.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public		 

abstract		 
class		 
RuleNode		 "
:		# $
	IRuleNode		% .
{

 
public 
Guid 
ID 
{ 
get 
; 
set !
;! "
}# $
=% &
Guid' +
.+ ,
NewGuid, 3
(3 4
)4 5
;5 6
public 
Guid 
ParentID 
{ 
get "
;" #
set$ '
;' (
}) *
private 
List 
< 
	IRuleNode 
> 
	_children  )
=* +
new, /
List0 4
<4 5
	IRuleNode5 >
>> ?
(? @
)@ A
;A B
public 
IEnumerable 
< 
	IRuleNode $
>$ %
Children& .
{ 	
get 
{ 
return 
	_children  
;  !
} 
set 
{ 
foreach 
( 
var 
child "
in# %
value& +
)+ ,
{ 
child 
. 
ParentID "
=# $
ID% '
;' (
	_children 
. 
Add !
(! "
child" '
)' (
;( )
} 
} 
} 	
public 
abstract 
Task 
< 
bool !
>! "
Passes# )
() *
)* +
;+ ,
	protected   
RuleNode   
(   
)   
{   
}    
	protected"" 
RuleNode"" 
("" 
params"" !
RuleNode""" *
[""* +
]""+ ,
rules""- 2
)""2 3
{## 	
Children$$ 
=$$ 
rules$$ 
.$$ 
ToList$$ #
($$# $
)$$$ %
;$$% &
}%% 	
}&& 
}'' ¯)
5D:\Repos\CommonCore\CommonCore2\RuleTrees\RuleTree.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

class 
RuleTree 
: 
	IRuleTree %
{		 
public 
	IRuleNode 
BaseNode !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
virtual 
async 
Task !
<! "
bool" &
>& '
Passes( .
(. /
)/ 0
=> 
await 
BaseNode 
. 
Passes $
($ %
)% &
;& '
public 
static 
async 
Task  
<  !
bool! %
>% &
	PassesAnd' 0
<0 1
T1 2
>2 3
(3 4
IEnumerable4 ?
<? @
T@ A
>A B
ChildrenC K
)K L
where 
T 
: 
	IRuleNode 
{ 	
foreach 
( 
var 
item 
in  
Children! )
)) *
{ 
if 
( 
! 
await 
item 
.  
Passes  &
(& '
)' (
)( )
return 
false  
;  !
} 
return 
true 
; 
} 	
public 
static 
async 
Task  
<  !
bool! %
>% &
PassesOr' /
</ 0
T0 1
>1 2
(2 3
IEnumerable3 >
<> ?
T? @
>@ A
ChildrenB J
)J K
where 
T 
: 
	IRuleNode 
{ 	
foreach 
( 
var 
item 
in  
Children! )
)) *
{ 
if 
( 
await 
item 
. 
Passes %
(% &
)& '
)' (
return   
true   
;    
}!! 
return"" 
false"" 
;"" 
}## 	
public%% 
static%% 
async%% 
Task%%  
<%%  !
bool%%! %
>%%% &
	PassesAnd%%' 0
(%%0 1
IEnumerable%%1 <
<%%< =
	IRuleNode%%= F
>%%F G
Children%%H P
)%%P Q
{&& 	
foreach'' 
('' 
var'' 
item'' 
in''  
Children''! )
)'') *
{(( 
if)) 
()) 
!)) 
await)) 
item)) 
.))  
Passes))  &
())& '
)))' (
)))( )
return** 
false**  
;**  !
}++ 
return,, 
true,, 
;,, 
}-- 	
public// 
static// 
async// 
Task//  
<//  !
bool//! %
>//% &
PassesOr//' /
(/// 0
IEnumerable//0 ;
<//; <
	IRuleNode//< E
>//E F
Children//G O
)//O P
{00 	
foreach11 
(11 
var11 
item11 
in11  
Children11! )
)11) *
{22 
if33 
(33 
await33 
item33 
.33 
Passes33 %
(33% &
)33& '
)33' (
return44 
true44 
;44  
}55 
return66 
false66 
;66 
}77 	
public99 
static99 
async99 
Task99  
<99  !
bool99! %
>99% &!
PassesLimitNotAllPass99' <
(99< =
IEnumerable99= H
<99H I
	IRuleNode99I R
>99R S
Children99T \
,99\ ]
int99^ a
limit99b g
=99h i
$num99j k
)99k l
{:: 	
var;; 
results;; 
=;; 
new;; 
List;; "
<;;" #
bool;;# '
>;;' (
(;;( )
);;) *
;;;* +
if== 
(== 
Children== 
.== 
Count== 
(== 
)==  
<==! "
limit==# (
+==) *
$num==+ ,
)==, -
return==. 4
false==5 :
;==: ;
foreach>> 
(>> 
var>> 
item>> 
in>>  
Children>>! )
)>>) *
{?? 
var@@ 

itemResult@@ 
=@@  
await@@! &
item@@' +
.@@+ ,
Passes@@, 2
(@@2 3
)@@3 4
;@@4 5
resultsAA 
.AA 
AddAA 
(AA 

itemResultAA &
)AA& '
;AA' (
}BB 
returnCC 
resultsCC 
.CC 
CountCC  
(CC  !
xCC! "
=>CC# %
xCC& '
)CC' (
<=CC) +
limitCC, 1
;CC1 2
}DD 	
}EE 
}FF ñ
>D:\Repos\CommonCore\CommonCore2\RuleTrees\RuleTreeAssembler.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

class 
RuleTreeAssembler "
:# $
IRuleTreeAssembler% 7
{ 
private

 
readonly

 "
IRuleTreeValueProvider

 /"
_ruleTreeValueProvider

0 F
;

F G
public 
RuleTreeAssembler  
(  !"
IRuleTreeValueProvider "!
ruleTreeValueProvider# 8
) 
{ 	"
_ruleTreeValueProvider "
=# $!
ruleTreeValueProvider% :
;: ;
} 	
public 
async 
Task 
Assemble "
(" #
	IRuleTree# ,
ruleTree- 5
)5 6
{ 	
await 
Assemble 
( 
ruleTree #
.# $
BaseNode$ ,
., -
Children- 5
)5 6
;6 7
} 	
private 
async 
Task 
Assemble #
(# $
IEnumerable$ /
</ 0
	IRuleNode0 9
>9 :
children; C
)C D
{ 	
foreach 
( 
var 
child 
in !
children" *
)* +
{ 
if 
( 
child 
is 
SearchParameterRule 0
rule1 5
)5 6
{ 
rule 
. 
ParentID !
=" #
child$ )
.) *
ID* ,
;, -
rule   
.   
ComparisonValue   (
=  ) *
await  + 0"
_ruleTreeValueProvider  1 G
.  G H
GetValue  H P
(  P Q
rule  Q U
.  U V
Key  V Y
)  Y Z
;  Z [
}!! 
await## 
Assemble## 
(## 
child## $
.##$ %
Children##% -
)##- .
;##. /
}$$ 
}%% 	
}&& 
}'' ¸
@D:\Repos\CommonCore\CommonCore2\RuleTrees\SearchParameterRule.cs
	namespace 	
CommonCore2
 
. 
	RuleTrees 
{ 
public 

abstract 
class 
SearchParameterRule -
:. /
RuleNode0 8
{ 
public 
string 
Key 
{ 
get 
;  
set! $
;$ %
}& '
public 
object 
ComparisonValue %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
SearchParameterRule "
(" #
)# $
{		 	
} 	
} 
} §
AD:\Repos\CommonCore\CommonCore2\Services\AuthenticationService.cs
	namespace 	
CommonCore2
 
. 
Services 
{ 
public		 

class		 !
AuthenticationService		 &
:		' ("
IAuthenticationService		) ?
{

 
private 
readonly !
IAuthenticationLoader .!
_authenticationLoader/ D
;D E
private 
readonly %
IAuthorizationTokenLoader 2
_tokenLoader3 ?
;? @
public !
AuthenticationService $
($ %!
IAuthenticationLoader ! 
authenticationLoader" 6
,6 7%
IAuthorizationTokenLoader %
tokenLoader& 1
) 
{ 	!
_authenticationLoader !
=" # 
authenticationLoader$ 8
;8 9
_tokenLoader 
= 
tokenLoader &
;& '
} 	
public 
async 
Task 
< 
	IResponse #
<# $
string$ *
>* +
>+ ,
Authenticate- 9
(9 :
PasswordRequest: I
requestJ Q
)Q R
{ 	
var "
authenticationResponse &
=' (
await) .!
_authenticationLoader/ D
.D E
AuthenticateE Q
(Q R
requestR Y
)Y Z
;Z [
if 
( 
! "
authenticationResponse '
.' (
Sucess( .
). /
return0 6
new7 :
MethodResponse; I
<I J
stringJ P
>P Q
(Q R
)R S
{ 
Sucess 
= 
false 
, 
Data 
= 
null 
, 
Errors 
= "
authenticationResponse /
./ 0
Errors0 6
} 
; 
return   
await   
_tokenLoader   %
.  % &
GetToken  & .
(  . /"
authenticationResponse  / E
.  E F
Data  F J
)  J K
;  K L
}!! 	
public## 
async## 
Task## 
<## 
	IResponse## #
>### $
SetupPassword##% 2
(##2 3
PasswordRequest##3 B
request##C J
)##J K
=>$$ 
await$$ !
_authenticationLoader$$ *
.$$* +
SetupPassword$$+ 8
($$8 9
request$$9 @
)$$@ A
;$$A B
}%% 
}&& 